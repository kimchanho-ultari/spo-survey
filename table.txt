CREATE TABLE `SURVEY` (
	`SURVEY_CODE` VARCHAR(32) NOT NULL,
	`SURVEY_TITLE` VARCHAR(256) NULL DEFAULT NULL,
	`SURVEY_CONTENTS` VARCHAR(1000) NULL DEFAULT NULL,
	`USER_ID` VARCHAR(64) NULL DEFAULT NULL,
	`IS_USE` CHAR(1) NULL DEFAULT 'Y',
	`REG_DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
	`START_DATETIME` TIMESTAMP NULL DEFAULT NULL,
	`END_DATETIME` TIMESTAMP NULL DEFAULT NULL,
	`IS_OPEN` CHAR(1) NULL DEFAULT 'Y',
	PRIMARY KEY (`SURVEY_CODE`)
)
COMMENT='설문';

CREATE TABLE `SURVEY_ITEM` (
	`ITEM_CODE` VARCHAR(32) NOT NULL,
	`ITEM_CONTENTS` VARCHAR(256) NULL DEFAULT NULL,
	`ITEM_TYPE` VARCHAR(6) NOT NULL DEFAULT 'CHOICE',
	`QUESTION_CODE` VARCHAR(32) NOT NULL,
	`SURVEY_CODE` VARCHAR(32) NULL DEFAULT NULL,
	`SORT` INT(11) NULL DEFAULT NULL,
	`DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`ITEM_CODE`, `QUESTION_CODE`)
)
COMMENT='설문항목';

CREATE TABLE `SURVEY_MEMBER` (
	`USER_ID` VARCHAR(64) NOT NULL,
	`SURVEY_CODE` VARCHAR(32) NOT NULL,
	`IS_COMPLETE` CHAR(1) NULL DEFAULT 'N',
	`DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`USER_ID`, `SURVEY_CODE`)
)
COMMENT='설문 멤버';

CREATE TABLE `SURVEY_QUESTION` (
	`QUESTION_CODE` VARCHAR(32) NOT NULL,
	`QUESTION_CONTENTS` VARCHAR(1000) NULL DEFAULT NULL,
	`IS_MULTI` CHAR(1) NULL DEFAULT 'N',
	`IS_ANONYMOUS` CHAR(1) NULL DEFAULT 'N',
	`SORT` INT(11) NULL DEFAULT NULL,
	`SURVEY_CODE` VARCHAR(32) NOT NULL,
	`DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`QUESTION_CODE`, `SURVEY_CODE`)
)
COMMENT='질문';

CREATE TABLE `SURVEY_RESULT` (
	`ITEM_CODE` VARCHAR(32) NOT NULL,
	`USER_ID` VARCHAR(64) NOT NULL,
	`SURVEY_CODE` VARCHAR(32) NULL DEFAULT NULL,
	`DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`ITEM_CODE`, `USER_ID`)
)
COMMENT='설문결과';

CREATE TABLE `SURVEY_RESULT_DESC` (
	`ITEM_CODE` VARCHAR(32) NOT NULL,
	`ITEM_DESC` VARCHAR(1000) NULL DEFAULT NULL,
	`USER_ID` VARCHAR(64) NOT NULL,
	`SURVEY_CODE` VARCHAR(32) NULL DEFAULT NULL,
	`DATETIME` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`ITEM_CODE`, `USER_ID`)
)
COMMENT='설문결과 (서술형)';

CREATE VIEW SURVEY_VW AS
SELECT 
		 SURVEY_CODE
		,SURVEY_TITLE
		,SURVEY_CONTENTS
		,USER_ID
		,REG_DATETIME
		,START_DATETIME
		,END_DATETIME
		,CASE WHEN END_DATETIME < CURRENT_TIMESTAMP() THEN 'Y' ELSE 'N' END AS IS_COMPLETE
		,IS_USE
		,IS_OPEN
FROM SURVEY
WHERE IS_USE = 'Y';